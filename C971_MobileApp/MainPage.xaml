<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:C971_MobileApp.Models"
             x:Class="C971_MobileApp.MainPage"
             Title="Academic Terms">

    <VerticalStackLayout Padding="10" Spacing="10">

        <!-- Title -->
        <Label
            Text="Academic Terms"
            FontSize="24"
            FontAttributes="Bold"
            HorizontalOptions="Center"
            VerticalOptions="Start" />

        <!-- Add Term Button -->
        <Button
            Text="Add a Term +"
            FontSize="18"
            HorizontalOptions="Fill"
            VerticalOptions="Start"
            Clicked="OnAddTermClicked" />

        <!-- Terms CollectionView -->
        <CollectionView x:Name="TermCollectionView" Margin="0,10,0,0">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <VerticalStackLayout Padding="10" Spacing="10" BackgroundColor="{StaticResource NeutralLightGray}" Margin="0,0,0,10">

                        <!-- Term Header -->
                        <Grid ColumnDefinitions="*,3*,*" RowDefinitions="Auto,Auto,Auto">
                            <!-- Row 0 -->
                            <Label 
                                Grid.Column="1" 
                                Grid.Row="0" 
                                Text="{Binding Title}" 
                                FontSize="20" 
                                FontAttributes="Bold" 
                                VerticalOptions="Center" 
                                HorizontalOptions="Center" />
                                <Label 
                                Grid.Column="2" 
                                Grid.Row="0" 
                                Text="{x:Static models:Icons.Edit}" 
                                Style="{StaticResource MaterialIcon}">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnEditTermTapped" />
                                </Label.GestureRecognizers>
                            </Label>

                            <!-- Row 1 -->
                            <Label 
                                Grid.Column="1" 
                                Grid.Row="1" 
                                Text="{Binding StartDate, StringFormat='Start: {0:MM/dd/yyyy}'}" 
                                FontSize="14" 
                                VerticalOptions="Center" 
                                HorizontalOptions="Center" />

                            <!-- Row 2 -->
                            <Label 
                                Grid.Column="0" 
                                Grid.Row="2" 
                                Text="{x:Static models:Icons.Delete}" 
                                Style="{StaticResource MaterialIcon}">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnDeleteTermTapped" />
                                </Label.GestureRecognizers>
                            </Label>
                            <Label 
                                Grid.Column="1" 
                                Grid.Row="2" 
                                Text="{Binding EndDate, StringFormat='End: {0:MM/dd/yyyy}'}" 
                                FontSize="14" 
                                VerticalOptions="Center" 
                                HorizontalOptions="Center" />
                            <Label 
                                Grid.Column="2" 
                                Grid.Row="2" 
                                Text="{Binding ExpandCollapseIcon}" 
                                Style="{StaticResource MaterialIcon}">
                                <Label.GestureRecognizers>
                                    <TapGestureRecognizer Tapped="OnToggleExpandTapped" />
                                </Label.GestureRecognizers>
                            </Label>
                        </Grid>

                        <!-- Courses List -->
                        <CollectionView x:Name="CoursesCollectionView" IsVisible="{Binding IsExpanded}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <VerticalStackLayout Padding="10" BackgroundColor="{StaticResource NeutralLightGray}">
                                        <Label Text="{Binding Title}" FontSize="18" />
                                        <Label Text="{Binding StartEndDate}" FontSize="14" />
                                        <HorizontalStackLayout>

                                            <!-- Edit Course Button -->
                                            <Label 
                                                Text="{x:Static models:Icons.Edit}" 
                                                Style="{StaticResource MaterialIcon}">
                                                <Label.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnEditCourseTapped" />
                                                </Label.GestureRecognizers>
                                            </Label>

                                            <!-- Course Details Button -->
                                            <Label 
                                                Text="{x:Static models:Icons.Expand}" 
                                                Style="{StaticResource MaterialIcon}">
                                                <Label.GestureRecognizers>
                                                    <TapGestureRecognizer Tapped="OnShowCourseDetailsTapped" />
                                                </Label.GestureRecognizers>
                                            </Label>
                                        </HorizontalStackLayout>
                                    </VerticalStackLayout>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>

                        <!-- Add Course Button -->
                        <Label 
                            Text="{x:Static models:Icons.Add}" 
                            Style="{StaticResource MaterialIcon}" 
                            IsVisible="{Binding IsExpanded}">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Tapped="OnAddCourseTapped" />
                            </Label.GestureRecognizers>
                        </Label>
                    </VerticalStackLayout>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </VerticalStackLayout>
</ContentPage>
